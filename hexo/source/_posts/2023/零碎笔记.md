---
title: 零碎笔记
abbrlink: 36605
date: 2023-02-08 10:33:26
categories:
  - 笔记
tags:
  - Linux
comments: true
license: true
cc_license: true
---
&ensp;
<!--more-->

## MacOS

### Homebrew

[homebrew](https://brew.sh/index_zh-cn)是MacOS中的**软件包的管理器**，如果网络环境较好，可以通过以下代码安装。

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

### smartmontools

据说，由于苹果对内存交换区使用了较为激进的策略， M1 芯片的 Macbook 硬盘写入量远大于其他电脑。安装smartmontools可以查看磁盘的状态。

```bash
brew install smartmontools
smartctl -a disk0
```



## GIT

### 清理仓库历史
``` bash
# 切换到一个脱离主分支的另外一条全新主分支，不用太在意叫什么，因为后面还会修改分支名称
git checkout --orphan latest_branch
# 暂存所有改动过的文件，内容为当前旧分支的最新版本所有文件
git add -A
#提交更改
git commit -am "commit message"
#删除原始主分支
git branch -D main
#将当前分支重命名为 main
git branch -m main
#最后，强制更新您的存储库
git push -f origin main

```

### [从仓库的历史记录中删除文件](https://docs.github.com/zh/repositories/working-with-files/managing-large-files/about-large-files-on-github#removing-files-from-a-repositorys-history)

### [上传文件到GitHub Realease](https://docs.github.com/en/rest/releases/assets?apiVersion=2022-11-28#upload-a-release-asset)

需要这些参数：

1. owner
2. repo
3. release_id
4. name 文件名

具体可查看[Python代码](https://github.com/shaoyaoqian/shaoyaoqian.github.io/releases/download/20230209/GitHub.API.upload.files.to.Release.py)

### 调用GitHub API处理Markdown文本
https://github.com/shaoyaoqian/shaoyaoqian.github.io/releases/download/20230209/text.html
https://github.com/shaoyaoqian/shaoyaoqian.github.io/releases/download/20230209/text.md
https://github.com/shaoyaoqian/shaoyaoqian.github.io/releases/download/20230209/github_markdown.py

## 邮件测试

### Python
```python
import smtplib
smtpObj = smtplib.SMTP_SSL("smtp.qq.com")
smtpObj.login("499908174@qq.com","zzokkzruycbobicd")
smtpObj.sendmail("499908174@qq.com","mapengfei@mail.nwpu.edu.cn","ddddfasdfa")
smtpObj.quit()

import smtplib
smtpObj = smtplib.SMTP_SSL("smtp.163.com",465)
smtpObj.login("merryjingle@163.com","OCDVFOFNDTXLIXGN")
smtpObj.sendmail("merryjingle@163.com","mail@pengfeima.cn","ddddfasdfa")
smtpObj.quit()
```

## Vercel

### [反向代理](https://blog.csdn.net/qq_39010320/article/details/119923538)

1. 创建配置文件`emoji.json`
``` bash
mkdir vercel
vi emoji.json
```
``` json
{
    "version": 2,
    "routes": [
        {"src": "/(.*)","dest": "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/$1"}
    ]
}
```
2. 安装、登陆Vercel，创建项目
``` bash
npm i -g vercel
vercel longin
vercel -A emoji.json --prod
```
``` bash
$ vercel -A emoji.json --prod
Vercel CLI 28.9.0
? Set up and deploy “~/Documents/GitHub/emoji/vercel”? [Y/n] y
? Which scope do you want to deploy to? shaoyaoqian
? Link to existing project? [y/N] n
? What’s your project’s name? shaoyaoqian-emoji
? In which directory is your code located? ./
Local settings detected in vercel.json:
No framework detected. Default Project Settings:
- Build Command: `npm run vercel-build` or `npm run build`
- Development Command: None
- Install Command: `yarn install`, `pnpm install`, or `npm install`
- Output Directory: `public` if it exists, or `.`
? Want to modify these settings? [y/N] n
🔗  Linked to shaoyaoqian/shaoyaoqian-emoji (created .vercel and added it to .gitignore)
🔍  Inspect: https://vercel.com/shaoyaoqian/shaoyaoqian-emoji/FyV69HGAWUtU4ihVFXq9hNtbaNzY [1s]
✅  Production: https://shaoyaoqian-emoji.vercel.app [6s]
```

## 表情包制作
#### 表情包下载
1. [Microsoft animated fluent emojis](https://github.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis)
2. [Blobcat](https://blob.cat/main/public)

#### [生成配置文件](https://github.com/kkfive/emotion_generate)


## docker-compose

### 搭建mysql服务
在mysql文件夹下创建`my.conf`和`docker-compose.yml`两个文件，通过命令`sudo docker-compose up -d`启动服务。
``` bash
mkdir mysql && cd mysql
```
``` conf
[mysqld]
user=mysql
default-storage-engine=INNODB
character-set-server=utf8
[client]
default-character-set=utf8
[mysql]
default-character-set=utf8
```
``` yml
version: '3'
services:
  mysql:
    image: mysql
    restart: always
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: password
      TZ: Asia/Shanghai
    ports:
      - 3306:3306
    volumes:
      - ./data:/var/lib/mysql
      - ./my.cnf:/etc/mysql/my.cnf
    command:
      --max_connections=1000
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_general_ci
      --default-authentication-plugin=mysql_native_password
```

### 定时执行Python脚本

1. `cronfile`用于设定定时执行脚本`run.sh`。

```cronfile
 50 * * * * cd /data && bash ./run.sh
```

2. `run.sh`设定执行命令。

```bash
#! /bin/sh
cd /data && rm *.html
cd /data && touch changjiang_daily.html tech_daily.html hubei_daily.html youth_daily.html 
cd /data && touch changjiang_sorted_daily.html tech_sorted_daily.html hubei_sorted_daily.html youth_sorted_daily.html 
cd /data && scrapy crawl tech_daily && scrapy crawl youth_daily && scrapy crawl hubei_daily && scrapy crawl changjiang_daily
cd /data && python3 send_result.py
```
3. `Dockerfile` 创建镜像。
``` dockerfile
FROM python:3.9.6 as builder
COPY src/ /opt/src
WORKDIR /opt/src
# Install python3
RUN pip install -r requirements.txt

FROM builder as builder_ex
# Install cron
RUN apt-get update && apt-get -y install cron 
# Copy hello-cron file to the cron.d directory
COPY src/cronfile /etc/cron.d/cron
# Give execution rights on the cron job
RUN chmod 0644 /etc/cron.d/cron
# Apply cron job
RUN crontab /etc/cron.d/cron
# Create the log file to be able to run tail
RUN touch /var/log/cron.log
# Run the command on container startup
CMD ["cron", "-f"]
```
4. `docker-compose.yml`用于创建容器。
``` docker-compose.yml
version: '3'
services:
  crawler:
    build: ../
    volumes:
        - ./log:/var/log
        - ./data:/data
    #   - ./data:/opt/src
```
文件夹结构如下：

![目录](https://githubimages.pengfeima.cn/images/202302161411698.png)